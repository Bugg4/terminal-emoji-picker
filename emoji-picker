#!/bin/bash

# Dependencies check
for cmd in jq fzf wl-copy; do
    if ! command -v $cmd &> /dev/null; then
        echo "Error: $cmd is not installed." >&2
        exit 1
    fi
done

FILE="unicode_17_emojis.json"

if [ ! -f "$FILE" ]; then
    echo "Error: $FILE not found. Run your Python script first."
    exit 1
fi

# Pipeline:
# 1. Filter for only 'fully-qualified' status
# 2. Format as: Emoji | Name (Group)
# 3. Fuzzy search
# 4. Extract emoji, strip newline, and copy
cat "$FILE" | \
    jq -r '.[] | select(.status == "fully-qualified") | "\(.emoji) \(.name) [\(.group)]"' | \
    fzf --height 50% \
        --border \
        --header "Unicode 17.0 - Fully Qualified Emojis Only" \
        --prompt "üîç " | \
    awk '{print $1}' | \
    tr -d '\n' | \
    wl-copy

echo "Successfully copied to clipboard!"